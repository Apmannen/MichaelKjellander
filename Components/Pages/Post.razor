@page "/inlagg/{Slug}"
@using MichaelKjellander.Communicators
@using MichaelKjellander.SharedUtils.Components
@using MichaelKjellander.Models.Wordpress
@using MichaelKjellander.Components.Boxes
@using MichaelKjellander.Config
@using MichaelKjellander.Models
@using MichaelKjellander.TmpName
@inject IHttpClientFactory ClientFactory
@inject Microsoft.Extensions.Options.IOptions<AppConfig> Options
@inject JsService JsService
@rendermode InteractiveServer

@if (_post != null)
{
    <PageTitle>
        @ComponentUtil.FormatPageTitle(_post.Title!)
    </PageTitle>
    <PostBox Post="_post" IsSingle="true"/>
}

@code {
    [Parameter] public string? Slug { get; set; }
    private WpPost? _post;

    protected override async Task OnInitializedAsync()
    {
        if (Slug == null)
        {
            return;
        }

        InternalApiCommunicator communicator = new InternalApiCommunicator(ClientFactory.CreateClient(), Options);
        ApiResponse<WpPost> postsData = await communicator.FetchPosts(postSlug: Slug);
        _post = postsData.Items![0];
    }

    protected override void OnAfterRender(bool firstRender)
    {
        //JsService.ScrollToTop();
    }

}